# max-man

> **High-Performance HFT Risk & Matching Engine** > çº¯ Go è¯­è¨€æ‰“é€ çš„é«˜é¢‘ã€ä½å»¶è¿Ÿã€ç”Ÿäº§çº§æ•°å­—è´§å¸äº¤æ˜“æ‰€æ ¸å¿ƒç³»ç»Ÿã€‚

## ğŸ“– é¡¹ç›®ç®€ä»‹
**max-man** æ˜¯ä¸€ä¸ªä¸ºäº†æŒ‘æˆ˜æè‡´æ€§èƒ½è€Œç”Ÿçš„äº¤æ˜“æ‰€åç«¯æ ¸å¿ƒã€‚å®ƒåŒ…å«é£æ§å¼•æ“ã€æ’®åˆå¼•æ“ä»¥åŠé“¾ä¸Šè¡ç”Ÿå“åŒæ­¥å™¨ã€‚
é¡¹ç›®ç›®æ ‡æ˜¯å¯¹æ ‡å¤´éƒ¨äº¤æ˜“æ‰€ï¼ˆBinance/Deribitï¼‰çš„æ€§èƒ½æ ‡å‡†ï¼Œæ ¸å¿ƒè·¯å¾„è¿½æ±‚ **é›¶å†…å­˜åˆ†é… (Zero Allocation)** å’Œ **çº³ç§’çº§ (ns)** å»¶è¿Ÿã€‚

---

## ğŸš€ æ ¸å¿ƒæŠ€æœ¯æ ‡å‡†
åœ¨æœ¬é¡¹ç›®å¼€å‘ä¸­ï¼Œä¸¥æ ¼éµå®ˆä»¥ä¸‹ HFT å·¥ç¨‹æ ‡å‡†ï¼š
- **Zero Allocation**: æ ¸å¿ƒçƒ­è·¯å¾„ï¼ˆHot Pathï¼‰ä¸¥ç¦ `new`/`make`ï¼Œå¿…é¡»ä½¿ç”¨å¯¹è±¡æ± æˆ–æ ˆå†…å­˜ã€‚
- **Lock-Free/Low-Lock**: å°½é‡ä½¿ç”¨ `atomic` æˆ–æ— é”æ•°æ®ç»“æ„ï¼Œå‡å°‘ `Mutex` ç«äº‰ã€‚
- **Memory Alignment**: ç»“æ„ä½“å­—æ®µæŒ‰å†…å­˜å¯¹é½æ’åˆ—ï¼Œæé«˜ CPU Cache å‘½ä¸­ç‡ã€‚
- **Profile Driven**: æ¯ä¸€è¡Œå…³é”®ä»£ç éƒ½å¿…é¡»ç»è¿‡ `Benchmark` å’Œ `pprof` (CPU/Mem) éªŒè¯ã€‚

---

## ğŸ“… å¼€å‘è·¯çº¿å›¾ (Roadmap)

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ­å»º (å·²å®Œæˆ)
- [x] **Day 1: é¡¹ç›®éª¨æ¶ä¸åŸºç¡€æ¨¡å‹**
    - [x] å®šä¹‰ç»Ÿä¸€çš„ `Account`, `Position`, `RiskInput/Output` ç»“æ„ã€‚
    - [x] å®ç°åŸºç¡€çš„çº¿æ€§é£æ§è®¡ç®—æµã€‚
- [x] **Day 2: æœŸæƒæ ¸å¿ƒç®—æ³•**
    - [x] Black-Scholes å®šä»·æ¨¡å‹å®ç°ã€‚
    - [x] Greeks (Delta/Gamma/Vega/Theta) è®¡ç®—ã€‚
- [x] **Day 3: éšå«æ³¢åŠ¨ç‡ä¸æƒ…æ™¯åˆ†æ**
    - [x] IV åæ¨ç®—æ³• (Newton-Raphson)ã€‚
    - [x] åŸºç¡€ PnL æƒ…æ™¯æ¨¡æ‹Ÿã€‚

### ç¬¬äºŒé˜¶æ®µï¼šæ°¸ç»­åˆçº¦ä¸é«˜æ€§èƒ½é£æ§ (å½“å‰é˜¶æ®µ)
- [ ] **Day 4: æ°¸ç»­åˆçº¦æ ¸å¿ƒ (Perp Core)**
    - [ ] èµ„é‡‘è´¹ç‡ (Funding Rate) ä¸ æœªå®ç°ç›ˆäº (uPnL) æ ¸å¿ƒç®—æ³•ã€‚
    - [ ] **ä¼˜åŒ–**: ç»“æ„ä½“å†…å­˜å¯¹é½ä¼˜åŒ–ã€‚
    - [ ] **ä¼˜åŒ–**: æ ¸å¿ƒè®¡ç®—å‡½æ•°çš„ Zero Allocation å®ç°ã€‚
    - [ ] **æµ‹è¯•**: ç¼–å†™ Benchmark è¯æ˜çº³ç§’çº§æ€§èƒ½ã€‚
- [ ] **Day 5: å®æ—¶æ•°æ®æµä¸å¹¶å‘æ¶æ„ (The Loop)**
    - [ ] æ¨¡æ‹Ÿé«˜é¢‘è¡Œæƒ…ç”Ÿæˆå™¨ (Ticker)ã€‚
    - [ ] å®ç°æ— é”/ä½é”çš„è¡Œæƒ…åˆ†å‘ç³»ç»Ÿ (Fan-out pattern)ã€‚
    - [ ] è§£å†³ Channel ç¼“å†²åŒºé˜»å¡é—®é¢˜ã€‚
- [ ] **Day 6: é«˜æ€§èƒ½é¢„è­¦ç³»ç»Ÿ (Alerting)**
    - [ ] Redis ZSet å®ç°ä»·æ ¼åŒºé—´è®¢é˜…ã€‚
    - [ ] è§£å†³â€œæƒŠç¾¤æ•ˆåº”â€ï¼šä½¿ç”¨ Pagination åˆ†æ‰¹æ‹‰å–ã€‚
    - [ ] Lua è„šæœ¬å°è£…åŸå­æ“ä½œã€‚
- [ ] **Day 7: å¼ºå¹³å¼•æ“ (Liquidation Engine)**
    - [ ] **ç®—æ³•**: åå‘ç´¢å¼•æ¨å¯¼å¼ºå¹³ä»·æ ¼ (Liq Price)ã€‚
    - [ ] **æ•°æ®ç»“æ„**: å†…å­˜ B-Tree / SkipList ç»´æŠ¤å¼ºå¹³çº¿ã€‚
    - [ ] å®ç°æ¯«ç§’çº§å¼ºå¹³è§¦å‘ï¼ˆéè½®è¯¢æ¨¡å¼ï¼‰ã€‚
- [ ] **Day 8: é˜¶æ®µæ€§å‹æµ‹ä¸ pprof ä¼˜åŒ–**
    - [ ] å…¨é“¾è·¯é›†æˆæµ‹è¯• (Mock Market -> Engine -> Alert/Liq)ã€‚
    - [ ] å‹åŠ›æµ‹è¯• (10w ç”¨æˆ·, 5000 TPS)ã€‚
    - [ ] æ·±åº¦ pprof åˆ†æ (CPU/Heap/Block/Trace) å¹¶æ¶ˆé™¤ç“¶é¢ˆã€‚

### ç¬¬ä¸‰é˜¶æ®µï¼šæ’®åˆå¼•æ“ä¸é“¾ä¸Šå®æˆ˜
- [ ] **Day 9: æ’®åˆå¼•æ“ (Matching Engine)**
    - [ ] å®ç° LOB (Limit Order Book) è®¢å•ç°¿ã€‚
    - [ ] æ ¸å¿ƒæ•°æ®ç»“æ„ï¼šçº¢é»‘æ ‘ (Red-Black Tree) æˆ– è·³è¡¨ã€‚
    - [ ] å®ç° Maker/Taker æ’®åˆé€»è¾‘ã€‚
    - [ ] æŒ‘æˆ˜ï¼šæ’®åˆè·¯å¾„é›¶ GCã€‚
- [ ] **Day 10: ç»„åˆä¿è¯é‡‘ä¸äº¤å‰²åˆçº¦**
    - [ ] å®ç°äº¤å‰²æ—¥æœŸé™ç»“æ„ã€‚
    - [ ] å®ç° Portfolio Margin (è·¨å¸ç§/è·¨æœŸå¯¹å†²å‡å…)ã€‚
    - [ ] çŸ©é˜µç›¸å…³æ€§è®¡ç®—ä¼˜åŒ– (SIMD/Assembly)ã€‚
- [ ] **Day 11: é“¾ä¸Šæ•°æ®åŒæ­¥ (On-Chain Indexer)**
    - [ ] Geth å®¢æˆ·ç«¯é›†æˆä¸ WebSocket ç›‘å¬ã€‚
    - [ ] å¤„ç†åŒºå—é‡ç»„ (Reorg) ä¸å›æ»šã€‚
    - [ ] é«˜é€Ÿ Log è§£æ (Ring Buffer + ABI Cache)ã€‚
- [ ] **Day 12: é“¾ä¸Šæ°¸ç»­æ¨¡å‹ (vAMM)**
    - [ ] æ¨¡æ‹Ÿ vAMM (x*y=k) å®šä»·æ¨¡å‹ã€‚
    - [ ] é¢„è¨€æœº (Oracle) ä»·æ ¼æ¸…æ´—ä¸é˜²æŠ¢è·‘è®¾è®¡ã€‚
- [ ] **Day 13: ç¾éš¾å·¥ç¨‹ (Chaos Engineering)**
    - [ ] å¼•å…¥ Chaos Mesh æ¨¡æ‹Ÿç½‘ç»œæŠ–åŠ¨ã€Redis å®•æœºã€‚
    - [ ] å®ç°ç†”æ–­ (Circuit Breaker) ä¸ä¼˜é›…é™çº§æœºåˆ¶ã€‚
- [ ] **Day 14: ç»ˆæéªŒæ”¶**
    - [ ] æ¨¡æ‹Ÿ "312" æç«¯è¡Œæƒ…å‹æµ‹ã€‚
    - [ ] äº§å‡ºæœ€ç»ˆæ€§èƒ½æŠ¥å‘Š (TPS, Latency P99)ã€‚

---

## ğŸ›  æŠ€æœ¯æ ˆ
- **Language**: Go (Golang) 1.21+
- **Data Structure**: Redis (ZSet for Indexing), B-Tree (Memory OrderBook)
- **Blockchain**: Geth (go-ethereum)
- **Monitoring**: Prometheus, Grafana, pprof
- **Architecture**: Microservices (Simulation), Event-Driven

## âš¡ æ€§èƒ½åŸºå‡† (Target)
- **Risk Calculation**: < 500 ns/op
- **Matching Latency**: < 10 Âµs/op
- **System Throughput**: > 50,000 TPS (Single Core)
- **GC Pressure**: Zero allocs/op in hot loop

---

## ğŸ“‚ ç›®å½•ç»“æ„
```text
max-man/
â”œâ”€â”€ cmd/                # å¯åŠ¨å…¥å£ (Engine, Simulation, Matching)
â”œâ”€â”€ pkg/                # å…¬å…±åº“ (Logger, Math)
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ risk/           # é£æ§æ ¸å¿ƒ (BS, Perp, Margin)
â”‚   â”œâ”€â”€ matching/       # æ’®åˆæ ¸å¿ƒ (OrderBook)
â”‚   â”œâ”€â”€ market/         # è¡Œæƒ…åˆ†å‘
â”‚   â”œâ”€â”€ liquidation/    # å¼ºå¹³é€»è¾‘
â”‚   â””â”€â”€ onchain/        # é“¾ä¸ŠåŒæ­¥
â”œâ”€â”€ tests/              # é›†æˆæµ‹è¯•ä¸ Benchmark
â””â”€â”€ README.md